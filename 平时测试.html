<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
				background-color: ;
			}
			html,body{
				height: 100%;
				white-space: nowrap;
				word-wrap: nowrap;
			}
			li{
				padding: 10px;
			}
			.left{
				float: left;
				width: 100px;
				height: 100px;
				background-color: #008000;
			}
			.right{
				margin-left: 100px;
				height: 100px;
				background-color: #FF0000;
			}
		</style>
	</head>
	<body>
		<div class="one">
			
		</div>
		<script type="text/javascript">
			function mypromise(func){
				var that=this;
				// 回调函数集
				that.funclist=[];
				// resolve方法
				function resolve(value){
					// 微任务
					setTimeout(()=>{
						that.data=value
						that.funclist.forEach((callback)=>{
							callback(value)
						})
					})
				}
				// 执行用户传入的函数
				func(resolve.bind(that))
			}
			mypromise.prototype.then=function(onResolved){
				var that=this;
				return new mypromise(resolve => {
					that.funclist.push(function(){
						var res=onResolved(that.data);
						if(res instanceof mypromise){
							res.then(resolve)
						}else{
							resolve(res);
						}
					})
				})
			}
			const func=resolve => {
				setTimeout(()=>{
					resolve(1)
				},1000)
			}
			var promise1 = new mypromise(func)
			promise1.then(res => {
			  console.log(res)
			  return new mypromise(resolve => {
			    setTimeout(() => {
			      resolve(2)
			    }, 500)
			  })
			})
			console.log(promise1);
		</script>
	</body>
</html>
 