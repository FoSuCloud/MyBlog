## tcp协议
* tcp的数据包是没有ip地址的，但是有源端口和目标端口，ip地址是由ip网际协议来完成的
* tcp请求报文中有一个seq序列号，tcp协议就是使用这个序列号来解决网络中数据包乱序的问题的，然后也可以进行数据包的重新组合
* tcp请求报文中一个ACK位，这个是用来确认接收到报文的，如果为1则表示接收到了，可以解决丢包的问题，没有包的话就响应ACK=0

## tcp连接的几个字段
* `URG是紧急位`
* `ACK是应答信号`
* `SYN是同步信号`
* `FIN是关闭连接的请求`

## 三握手
TCP连接的三握手其实就是客户端和服务器端互相确认彼此可以发送信息的过程；
* 首先客户端发送第一条报文给服务器端，服务器端接收到客户端请求，也就表明服务器知道客户端可以发送信息给自己了，但是客户端还不知道，所以服务器还需要发送第二条报文给客户端，告诉客户端，你发的信息，我收到啦！
* 客户端接收到服务器端发送过来的第二条报文之后，就知道自己发送的第一条报文成功了，但是这个时候，服务器还不知道自己发给客户端的报文有没有成功呢，所以客户端需要发送第三条报文给服务器端，告诉服务器，你发送成功啦~
* 服务器接收到客户端发送给它的第三条报文，知道自己发给客户端的第二条报文成功啦，也就是自己可以正确发信息给客户端。
这个时候，服务器和客户端都知道彼此可以正确的发送报文给对方了，这就是TCP连接的三握手。
1. 第一次握手：设置请求连接位 SYN=1; 生成初始序列号 seq=x; 请求和服务器端建立连接
2. 第二次握手：服务器接收到请求报文，然后发送响应报文，设置同步位ACK=1,并且服务器也请求和客户端建立连接，所以SYN=1 初始序列号seq=y; 响应号ack=x+1;
3. 第三次握手：客户端接收到响应报文，然后发送响应报文，设置同步位ACK=1,响应号ack=y+1,序列号seq=x+1(在之前的基础上加一，因为消耗了一个)

## 四挥手
1. 首先客户端向服务器发送一个确认报文，告诉服务器该释放连接了
2. 然后服务器接收到报文，就会发送一个确认报文给客户端，表示自己知道了
3. `然后服务器会继续发送剩下的数据给客户端，等到发送完毕再进行第三次挥手`
4. 第三次挥手是服务器向客户端发送请求，告诉客户端，数据发送完成啦
5. 客户端接收到报文后就会再发送最后一次报文给服务器，然后关闭连接。服务器接收到报文后也会关闭连接
---
1. 第一次挥手：首先客户端设置断开连接位FIN=1,生成初始序列号seq=u(客户端最后一次发的报文的序列号基础上加一)
2. 第二次挥手：服务器端接收到断开连接的请求，发送响应报文，同步位ACK=1,ack=u+1,seq=v(v是服务器最后一次发的报文的序列号基础加一)
* 注意，为什么还会有第三次挥手呢？因为第二次挥手后还可以继续发送数据报给客户端，因为tcp是全双工协议，客户端的同步位FIN=1之后
* 只是不可以发送数据报，但是还可以接受数据报文，所以服务器第二次挥手后还可能继续发送数据包
* 那么不需要再发数据报文的话，还需要四次挥手吗？答案是需要，因为第二次挥手只是对第一次挥手的响应，并没有设置FIN=1,服务端也需要断开连接！
3. 第三次挥手：服务器端发送完数据之后，再响应一次，ACK=1,FIN=1(断开连接)，ack=u+1(和第二次的一样，因为没有消耗)，生成的序列号seq=w(如果第二次挥手后还发了数据包，那么就是最后一次发的报文的序列号基础上加一)
4. 第四次挥手：客户端接收到第二次响应报文后就可以可以不再接受数据了，然后在发送一个响应报文给服务器。
* ACK=1, seq=u+1(第一次挥手的序列号基础上+1)，ack=w+1

## 数据传输
* 数据传输一般来说分为两个步骤（前提是已经连接了）：
1. 首先客户端向服务器端请求一个数据，请求报文的seq=y+1(上一个报文的序列号基础上+1);
2. 服务器接收到请求数据的报文后，发送响应报文，ack=y+2

## UDP协议和TCP协议的区别
1. TCP协议保证数据正确性，保证数据顺序；UDP不保证数据顺序，UDP可能丢包
2. UDP是无连接的，而TCP是面向连接的，也就是TCP连接之前都需要进行三握手，断开连接进行四挥手
3. TCP基于`字节流模式`，而UDP是基于数据报模式
4. TCP需要的系统资源较多，而UDP需要的系统资源较少
5. `每一条TCP连接都是点到点的，而UDP连接支持一对一，一对多，多对多的交互通信`
6. `tcp有序列号和窗口大小(提高效率)，而udp没有`

## udp也有源端口/目的端口/长度/校验和

## internet骨干网中的路由器通过BGP协议传输数据,BGP协议使用传输层的协议是tcp协议，端口是179端口

## tcp协议的拥塞控制就是防止过多的数据注入到网络中
* 拥塞控制可以使网络中的路由器或者链路不至于过载，常用的方法:`慢开始，拥塞控制`

## 在TCP的会话过程中，允许动态协商窗口大小，从而更加有效地利用带宽
