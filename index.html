<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag and Drop with Real-time Update Demo</title>
    <style>
        #draggable {
            width: 100px;
            height: 100px;
            background-color: #f00;
            position: absolute;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="draggable"></div>

<script>
    // 获取可拖拽元素
    const draggableElement = document.getElementById('draggable');

    // 初始拖拽状态
    let isDragging = false;
    let startPosition = { x: 0, y: 0 };

    // 鼠标按下事件处理函数
    function handleMouseDown(event) {
        isDragging = true;
        startPosition = {
            x: event.clientX - draggableElement.offsetLeft,
            y: event.clientY - draggableElement.offsetTop
        };
    }

    // 鼠标移动事件处理函数
    function handleMouseMove(event) {
        if (isDragging) {
            console.log("handleMouseMove updateDrag");
            const newPositionX = event.clientX - startPosition.x;
            const newPositionY = event.clientY - startPosition.y;

            // 更新拖拽元素位置
            draggableElement.style.left = newPositionX + 'px';
            draggableElement.style.top = newPositionY + 'px';
        }
    }

    // 鼠标松开事件处理函数
    function handleMouseUp() {
        isDragging = false;
    }

    // 监听鼠标按下事件
    draggableElement.addEventListener('mousedown', handleMouseDown);
    // 监听鼠标移动事件
    document.addEventListener('mousemove', handleMouseMove);
    // 使用requestAnimationFrame 甚至还卡顿
    // document.addEventListener('mousemove', updateDrag);
    // 监听鼠标松开事件
    document.addEventListener('mouseup', handleMouseUp);

    // 使用 requestAnimationFrame 实现实时更新拖拽位置
    function updateDrag() {
        if (isDragging) {
            console.log("requestAnimationFrame updateDrag");
            requestAnimationFrame(updateDrag);
            const newPositionX = event.clientX - startPosition.x;
            const newPositionY = event.clientY - startPosition.y;
            // 更新拖拽元素位置
            draggableElement.style.left = newPositionX + 'px';
            draggableElement.style.top = newPositionY + 'px';
        }
    }

    // 启动实时更新拖拽位置
    requestAnimationFrame(updateDrag);
</script>

</body>
</html>
