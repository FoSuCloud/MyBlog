<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexedDB Demo</title>
</head>
<body>

<input type="file" id="fileInput">
<button id="saveButton">保存图片到 IndexedDB</button>
<div id="imageContainer"></div>

<script>
    // 打开或创建一个名为 "images" 的数据库，并定义一个名为 "pictures" 的对象存储
    const dbPromise = window.indexedDB.open("images", 1);

    dbPromise.onupgradeneeded = function(event) {
        const db = event.target.result;
        if (!db.objectStoreNames.contains("pictures")) {
            db.createObjectStore("pictures");
        }
    };

    dbPromise.onsuccess = function(event) {
        const db = event.target.result;

        // 当选择了文件后，将文件保存到 IndexedDB 中
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            saveFileToIndexedDB(file);
        });

        // 当点击按钮后，从 IndexedDB 中读取并显示图片
        document.getElementById('saveButton').addEventListener('click', function() {
            displayImageFromIndexedDB();
        });
    };

    function saveFileToIndexedDB(file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const imageData = event.target.result;
            const db = dbPromise.result;
            const tx = db.transaction("pictures", "readwrite");
            const store = tx.objectStore("pictures");
            store.put(imageData, "picture"); // 保存图片数据到 IndexedDB 中，使用 "picture" 作为键
            tx.oncomplete = function() {
                console.log('图片已保存到 IndexedDB');
            };
        };
        reader.readAsDataURL(file); // 将文件读取为 Base64 格式的数据
    }

    function displayImageFromIndexedDB() {
        const db = dbPromise.result;
        const tx = db.transaction("pictures", "readonly");
        const store = tx.objectStore("pictures");
        const request = store.get("picture");
        request.onsuccess = function(event) {
            const imageData = event.target.result;
            const imageContainer = document.getElementById('imageContainer');
            imageContainer.innerHTML = '<img src="' + imageData + '" alt="Saved Image">';
        };
    }

</script>

</body>
</html>
