## XREAD：以阻塞或非阻塞方式获取流元素
* 与XRANGE命令和XREVRANGE命令可以从两个方向对流进行迭代不同，XREAD命令只能从一个方向对流进行迭代，
* `但是它提供了更简单的迭代API，支持同时对多个流进行迭代，并且能够以阻塞和非阻塞两种方式执行`

#### 从多个流中获取大于指定ID的元素
* XREAD命令最基础的用法就是从`多个给定流中取出大于指定ID的多个元素`，
* 其中紧跟在STREAMS选项之后的就是流的名字以及与之相对应的元素ID：

* `注意count 3选项要加到前面，因为streams的参数不固定`
```redis
127.0.0.1:6379> xread count 3 streams ministream 1688223077628
1) 1) "ministream"
   2) 1) 1) "1688223146581-0"
         2) 1) "k5"
            2) "v5"
      2) 1) "1688225374396-0"
         2) 1) "k6"
            2) "v6"
      3) 1) "1688225378120-0"
         2) 1) "k7"
            2) "v7"
```
* `1) 1) "ministream"表示下面的元素都来自于ministream流`

* `从ministream、s1流中分别取出ID大于1688223077628,1688226942821的元素`
```angular2html
127.0.0.1:6379> xread count 3 streams  ministream s1 1688223077628 1688226942821
1) 1) "ministream"
   2) 1) 1) "1688223146581-0"
         2) 1) "k5"
            2) "v5"
      2) 1) "1688225374396-0"
         2) 1) "k6"
            2) "v6"
      3) 1) "1688225378120-0"
         2) 1) "k7"
            2) "v7"
2) 1) "s1"
   2) 1) 1) "1688226946322-0"
         2) 1) "k2"
            2) "v2"
      2) 1) "1688226950468-0"
         2) 1) "k3"
            2) "v3"
```
* `最后，如果用户尝试使用XREAD命令去获取一个不存在的流，或者给定的ID超过了流中已有元素的最大ID，那么命令将返回一个空值作为结果：`


#### 迭代流
1）将表示`流起点的特殊ID 0-0（或者它的简写0）`作为ID传入XREAD命令，并通过COUNT选项读取流最开头的N个元素。
2）使用命令返回的最后一个元素的ID作为参数，再次调用带有COUNT选项的XREAD命令。
3）重复执行步骤2，直到命令返回空值或者命令返回元素的数量少于指定数量为止。

* 假设我们想要以两个元素为步进迭代流stream
```redis
127.0.0.1:6379> xread count 2 streams ministream 0
1) 1) "ministream"
   2) 1) 1) "1688223077628-0"
         2) 1) "k3"
            2) "v3"
      2) 1) "1688223146581-0"
         2) 1) "k5"
            2) "v5"
```
* 以上一个结束元素的ID作为起始ID
```redis
127.0.0.1:6379> xread count 2 streams ministream 1688223146581-0
1) 1) "ministream"
   2) 1) 1) "1688225374396-0"
         2) 1) "k6"
            2) "v6"
      2) 1) "1688225378120-0"
         2) 1) "k7"
            2) "v7"
```

#### 阻塞
* `通过使用BLOCK选项并给定一个毫秒精度的超时时间作为参数，用户能够以可阻塞的方式执行XREAD命令：`

* `BLOCK选项的值可以是任何大于等于0的数值，给定0则表示阻塞直到出现可返回的元素为止。`
* 根据用户给定的流是否拥有符合条件的元素，带有BLOCK选项的XREAD命令的行为也会有所不同。

* 首先，如果在用户给定的流中，`有一个或多个流拥有符合条件、可供读取的元素，那么XREAD命令将直接返回这些元素而不会进入阻塞状态。`
* 与不带BLOCK选项的XREAD命令一样，这种情况下的XREAD命令会根据用户给定的COUNT选项去限制每个流返回元素的数量。

* 例子：首先创建一个没有元素的流temp-stream，然后 block 10000 表示阻塞10秒
```redis
127.0.0.1:6379> xrange temp-stream - +
(empty list or set)
127.0.0.1:6379> xread block 10000 count 2 streams ministream temp-stream 0 0
1) 1) "ministream"
   2) 1) 1) "1688223077628-0"
         2) 1) "k3"
            2) "v3"
      2) 1) "1688223146581-0"
         2) 1) "k5"
            2) "v5"
```
* `但是由于ministream流中有符合条件的元素，所以命令没有进入阻塞状态，而是直接返回了可供读取的元素`

* `只对空的流进行读取，发现阻塞了10秒多一点`
```redis
127.0.0.1:6379> xread block 10000 count 2 streams temp-stream 0
(nil)
(10.04s)
```

* `如果在阻塞过程中，给空的流添加了新元素，那么命令会立刻停止阻塞，返回元素`

#### 只获取新的元素
* Redis为XREAD命令提供了特殊ID参数$符号，用户在执行阻塞式的XREAD命令时，
* `只要将$符号用作ID参数的值，XREAD命令就会只获取给定流在命令执行之后新出现的元素`：

```redis
127.0.0.1:6379> xread block 10000 streams ministream $
1) 1) "ministream"
   2) 1) 1) "1688297269378-0"
         2) 1) "k10"
            2) "v10"
(1.86s)
```
* 在1.86秒内，ministream流中没有新元素，所以命令没有返回任何元素
* 然后执行
```redis
127.0.0.1:6379> xadd ministream * k10 v10
"1688297269378-0"
```
* 发现命令`立刻返回了新元素，并且立刻解除阻塞`



